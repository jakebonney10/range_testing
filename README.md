# range_testing
Code developed for my MS thesis titled "Characterizing the Seasonal and Environmental Effects on High Frequency Acoustic Fish Tag Detection in Shallow Water Settings."

https://digitalcommons.uri.edu/theses/2084/

## Background
In recent years, acoustic telemetry research programs have increased in their spatial extent along the Atlantic coastline, U.S.. These programs often aim to monitor movements of marine organisms in aquatic systems using a combination of acoustic transmitters and/or acoustic receiver arrays. With the increasing use of this technology, it is important that users understand the uncertainty associated with tag detectability to both inform the acoustic receiver designs and interpret tag detection data. Coded acoustic telemetry devices, such as the Vemco V16 69 kHz tag, use unmodulated, fixed frequency pulses with information coded in the spacing between pulses to transmit and decipher unique serial ID numbers associated with individual tags. This encoding technique is referred to as Pulse Position Modulation (PPM). The signal processing techniques used by Vemco receivers to determine whether a signal is classified as a detection is proprietary; however, classic detection theory states that the detection of acoustic signals in any given environment is dependent on the Signal-to-Noise-Ratio (SNR) measured at the output of a receiver. The acoustic fish tag manufacturer Vemco currently recommends a methodology for estimating detectability that is based on statistical analyses of static field deployments in receiver areas. Detection data collected over varying sampling periodicity is often analyzed to determine the number of recorded detections compared to the number of expected detections. 

## Problem
Common setups for range testing studies require several stationary receiver configurations spaced out at set intervals (e.g., 400, 600, 800, 1000 meters) from range testing tags for every receiver location present in a study. While this strategy is effective at formulating probability of detection estimates for a given location and time, it is costly, time consuming, and fails to fully investigate the underlying drivers responsible for changes in the acoustic environment that affect tag detections. This is particularly relevant within turbid and complex coastal water settings such as Narragansett Bay, where the acoustic environment changes rapidly. Vemco, the manufacturer of the acoustic telemetry tags used in this study, lists the following as factors influencing tag detection: signal strength, transmission loss, line of sight, reflection/refraction, multipath, environmental and anthropogenic noise, and source/receiver directivity. This paper offers an alternative strategy for estimating tag detection range utilizing an acoustic drift and anchor approach to measure the transmission loss and detections/non-detections for a given receiver location. This field testing strategy, coupled with acoustic propagation modeling techniques, provides a greater understanding of the underlying environmental and anthropogenic drivers affecting tag detection, without the need for expensive and long-term mooring deployments. 

## Approach
An alternative approach for estimating the detection range of high frequency acoustic fish tags was implemented in this study. A series of drifts within Rhode Island (RI) state waters measured the acoustic transmission loss over range for a Vemco V16 69 kHz fish tag. The environmental characteristics of the acoustic soundscape recorded during testing (depth, sound speed, absorption level, sediment type) were input into the ray acoustic propagation modeling tool Bellhop to model the transmission loss of the Vemco fish tag with range. The modeled output was compared to and validated by the measured acoustic field data. This modeling effort successfully demonstrated that transmission loss of high frequency acoustic fish tags can be determined through simulation. A logistic regression model was then used to model the binary probability of detection output from Vemco VR2W receivers collected during testing. The modeled transmission loss levels and probability of detection informed the decision to set a level of 6 dB above recorded noise levels as the 50% probability of detection threshold. This study thus provided an estimate of the detection range for the existing receiver array in Rhode Island waters. After determining the probability of detection threshold, additional environmental scenarios were modeled in Bellhop to illustrate the effects of variation in the acoustic environment on detection range. This approach can be used to understand the variability in detection range based on spatial/temporal dynamics and hence to plan the receiver array spacings at any given location.

## Bellhop Methods
Data collected during range testing were used as inputs into Bellhop, an open-source acoustic propagation model that uses beam tracing for predicting acoustic pressure fields in ocean environments. Bellhop is a widely accepted tool used to study high frequency acoustic propagation in shallow water environments. The [Ocean Acoustics MATLAB Toolbox ver. 2021](http://oalib.hlsresearch.com/AcousticsToolbox/) was used to run the Bellhop program. Acoustic properties of the seafloor at test sites were inferred using sediment descriptors outlined in studies by the USGS and McMaster. Based on these descriptors, the geoacoustic parameters of sound speed, density, and attenuation were determined using the common table of sediment properties given by Richardson. Bottom depth was measured with the transducer aboard the research vessel used for the range test. Model parameters including time and location specific SSP and absorption levels, location specific bottom characteristics, and range dependent bathymetry can be seen in the .env files. Common modeling parameters between all environmental files are listed in the table below. The center frequency of 69 kHz was used as an approximation for the actual frequency spread of the tag's signal as Vemco tags emit energy across a bandwidth of several hundred Hz, between 68,500 and 69,500 Hz. The source depth used in the modeling study matched the design utilized in range testing.

Freq.(kHz)|	SSP Interp.| Attenuation Units | Surface Type |	Bottom Type | Ray Angles | Run Type | #Beams | Range & Depth Step Size (m) | Range (km)
--------- | ---------- | ----------------- | ------------ | ----------- | ---------- | -------- | ------ | --------------------------- | ---------       
69	    | C-Linear   | dB/λ	             | Vacuum       | Acoustic half space	 | +- 30°   | Arrivals/Gaussian beam | 100 | 0.2 | 1.25


Now, because the Vemco tag is an impulsive source, there is the potential for multipath arrivals to impact the accuracy of the received signal. The incoherent transmission loss model for Bellhop incoherently combines the contributions from all multipath arrivals and therefore may not appropriately characterize the signal depending on the environment and source/receiver configuration. Similarly, a simple geometric spreading model TL_geometric.m overestimates detection range as it also fails to consider multipath effects. To appropriately model the propagation of a Vemco tag ping through a channel and obtain the received signal level, several steps need to be followed. Firstly, Bellhop is run in the "arrivals" mode. Then, the output from Bellhop in the form of ray/amplitude data is used to create the channel impulse response. Scattering loss due to a rough seafloor is applied to the amplitude of each ray using the grazing angle and number of bottom bounces for each arrival where R_G is the coherent reflection coefficient for a surface having a Gaussian PDF. The function that performs this operation is scatterrg(). In this function k is the wave number, σ is the surface roughness in meters, and θ is the grazing angle in radians. Finally, the source signal, a 5 millisecond 69 kHz sine wave, is propagated through the channel by convolving the modeled channel with the source signal. The convolution operation involves integrating the product of the impulse response and the time-shifted source signal over time. This operation effectively "slides" the impulse response along the time axis, multiplying it with the source signal at each point and adding up the results to produce the output signal. The initial arrival in the resulting waveform provides the received level of the signal that will be detected and processed by the VEMCO receiver.

The modeled output of receive level was then calculated over each set of arrivals as a function of range. A moving average filter generates a smooth plot of recieve level vs range, as the convolution output is quite noisy. Modeled receive level was compared to and validated by the Vemco V16 test tag receive levels measured during each of the six range tests. By validating the acoustic modeling approach with the collected field data, predicted scenarios could be modeled with varying environmental parameters to see how individual changes effect detection ranges. 

## Results
The threshold was set where modeled results reached a level of 6 dB above recorded noise levels, yielding detection ranges between 526.3-838.8 meters. 

## Acknowledgements
A special thank you goes to Wouter Falkena for their xml2struct() function, available here: https://www.mathworks.com/matlabcentral/fileexchange/28518-xml2struct and Zohar Bar-Yehuda for plot_google_map routine, available here: https://www.mathworks.com/matlabcentral/fileexchange/27627-zoharby-plot_google_map
